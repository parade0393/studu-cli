`.gitattributes` 是 **Git 用来定义“文件属性规则”的配置文件**，它会影响 **Git 如何对待不同文件**（而不是代码怎么运行）。在团队协作、跨平台、二进制文件、自动化工具场景里非常重要。

可以把它理解成：

> **“告诉 Git：某些文件该怎么处理”**

---

## 一、`.gitattributes` 能解决什么问题？

### 1️⃣ 不同系统的换行符问题（最常见）

Windows / macOS / Linux 换行符不同，很容易出现：

- 你这边没改代码，Git 却显示一堆 diff
- CI / lint 报错

`.gitattributes` 可以 **统一换行规则**

```gitattributes
* text=auto
```

含义：

- Git 自动识别文本文件
- 仓库里统一用 LF
- checkout 到 Windows 会转成 CRLF（如果需要）,但是 text=auto eol=lf则强制所有平台都是LF

更精确一点：

```gitattributes
*.js   text eol=lf
*.ts   text eol=lf
*.sh   text eol=lf
```

---

### 2️⃣ 声明哪些是二进制文件（防止 diff 乱码）

如果不声明，Git 可能会尝试对二进制文件做文本 diff：

```gitattributes
*.png  binary
*.jpg  binary
*.pdf  binary
*.zip  binary
```

效果：

- Git 不会尝试比较内容
- diff / merge 更安全
- 性能更好

---

### 3️⃣ 控制 diff / merge 行为（高级用法）

#### 禁止某些文件参与 diff

```gitattributes
package-lock.json -diff
pnpm-lock.yaml    -diff
```

#### 使用自定义 diff 驱动

```gitattributes
*.lock diff=lock
```

然后在 `.gitconfig` 里定义 diff 规则。

---

### 4️⃣ 控制 merge 冲突策略

#### 始终保留某一方（配置文件很有用）

```gitattributes
.env merge=ours
```

含义：

- merge 冲突时，**始终使用当前分支的版本**

> 这对你之前提到的 `.env.local` / 环境配置文件特别有价值

---

### 5️⃣ Git LFS（大文件管理）

`.gitattributes` 是 **Git LFS 的核心配置文件**

```gitattributes
*.psd filter=lfs diff=lfs merge=lfs -text
*.mp4 filter=lfs diff=lfs merge=lfs -text
```

告诉 Git：

- 这些文件不直接进 Git
- 用 LFS 管理

---

### 6️⃣ 影响 `git archive` / 导出行为

```gitattributes
docs/** export-ignore
```

- `git archive` 打包时不会包含 `docs`

---

## 二、`.gitattributes` 和 `.gitignore` 的区别

| 对比              | `.gitignore` | `.gitattributes` |
| ----------------- | ------------ | ---------------- |
| 是否提交到仓库    | ✅           | ✅               |
| 作用              | 是否跟踪文件 | 如何处理文件     |
| 控制 diff / merge | ❌           | ✅               |
| 控制换行符        | ❌           | ✅               |
| LFS 支持          | ❌           | ✅               |

一句话总结：

> `.gitignore` 决定 **进不进仓库**
> `.gitattributes` 决定 **进了仓库怎么对待**

---

## 三、前端 / Vue 项目常见推荐配置

结合你之前的 Vue + Vite + TS 项目，**一个实用模板**👇

```gitattributes
# 默认文本规则
* text=auto

# 前端源码
*.js   text eol=lf
*.ts   text eol=lf
*.vue  text eol=lf
*.css  text eol=lf
*.scss text eol=lf
*.json text eol=lf
*.md   text eol=lf

# 脚本
*.sh   text eol=lf

# 二进制文件
*.png  binary
*.jpg  binary
*.jpeg binary
*.gif  binary
*.webp binary
*.svg  binary
*.ico  binary
*.pdf  binary

# 锁文件（可选）
pnpm-lock.yaml -diff
```

---

## 四、一个容易踩的坑 ⚠️

`.gitattributes` **只对“重新加入索引的文件”生效**

如果你已经提交过文件，改了 `.gitattributes`，需要：

```bash
git rm --cached -r .
git add .
git commit -m "chore: normalize line endings"
```

---

## 五、一句话总结

> `.gitattributes` 是 **Git 的“文件处理说明书”**
> 它决定：换行、diff、merge、LFS、二进制处理
> 在多人 + 跨系统 + CI 场景下非常关键
